== mod.io Mod Browser UI

=== UI-Specific Plugin Modules

The mod.io UE Plugin also includes a series of additional modules which provide an embedded mod browser and manager you can include in your own game.

[.stretch,stripes=odd,frame=none, cols="25%,~,"]
|===
|Module Name|Description|Module Type

|ModioUI|Core UI module containing all Slate and UMG widgets for the UI|Runtime
|ModioUIEditor|Editor details customization and asset factories for UI classes|Editor
|MSDFSupport|Module containing material expression for rendering MSDF textures as pseudo-vectors|Runtime
|MSDFSupportEditor|Importer for SVGs that will convert them to MSDF textures the UI can render|Editor
|===

These modules are optional - you can remove them, the UI folder in the Plugin Content directory, and the associated entries in the modio.uplugin file, and the core functionality from the Modio module will remain available in your project.

=== Displaying the Mod Browser

The main Mod Browser widget is located at /Modio/UI/Browser/Views/ModioModBrowserWidget.ModioModBrowserWidget. Once the Plugin has been initialized, you can show the Mod Browser via a new UI-focused subsystem, `UModioUISubsystem`.
Currently the mod browser does not support being embedded inside your own UI hierarchy, so you must load it directly (for instance, from a button on your main menu).

.Blueprint Example
[%collapsible]
====

From Blueprint, you can use the <<ShowModBrowserUIForPlayer>> node.

image::img/plugin_ui_showforplayer.png[]

====

.C++ Example
[%collapsible]
====

[source,c++, subs="+macros"]
----
// After you've called <<K2_InitializeAsync>> and the plugin is initialized successfully:

if (UModioUISubsystem* Subsystem = GEngine->GetEngineSubsystem<UModioUISubsystem>())
{
    if (UWorld* CurrentWorld = GetWorld())
    {
        if (APlayerController* PC = CurrentWorld->GetFirstPlayerController())
        {
            // Create and bind a delegate to be invoked when the browser is closed
            FOnModBrowserClosed BrowserClosedDelegate;
            // OnModBrowserClosed needs to be marked UFUNCTION()
            BrowserClosedDelegate.BindDynamic(this, &ASomeActor::OnModBrowserClosed);

            // Get a reference to the mod browser implementation (this will be exposed in the UI Settings object
            // in a future release)
            FSoftClassPath MenuClassReference =
                "/modio/UI/Browser/Views/ModioModBrowserWidget.ModioModBrowserWidget_C";
            UClass* ReferencedClass = MenuClassReference.ResolveClass();
            if (ReferencedClass)
            {
                // Request the browser widget be instantiated and displayed
                UModioMenu* MenuWidget =
                    Subsystem->ShowModBrowserUIForPlayer(ReferencedClass, PC, BrowserClosedDelegate);
                if (MenuWidget)
                {
                    // Focus the user on the browser
                    UWidgetBlueprintLibrary::SetInputMode_UIOnlyEx(PC, MenuWidget);
                }
            }
        }
    }
}
----
====

You can close the Mod Browser by calling `CloseModBrowserUI()` on the ModioUISubsystem.

=== Configuration

The mod.io Mod Browser will utilise the configuration that you provided on the mod.io Plugin Settings page referenced above; however, there are a number of additional UI-specific settings you will need to update to match your project's requirements. These are all accessible on the `mod.io UI` settings page in your project settings.

==== Input Mappings

image::img/plugin_ui_inputmapping.png[]

The mod.io Mod Browser requires you to map your project's input actions and axes to the virtual keys we use internally, so that the UI automatically respects your bindings, as well as any rebinding functionality you support.

To configure these mappings, expand the `Modio to Project Input Mappings` section. For each of our virtual keys, map at least one, but optionally more, Input Actions or Axes from your project. The UI will resolve any keypresses it receives, against the actions and axes you specify, to respond to user input. 

==== UI Style Set

image::img/plugin_ui_styleset.png[]

The Style Set defines UI properties such as colors, materials, widget styles, and more that can be altered to suit the aesthetic of your game. Each of these style types are split into separate assets to be managed individually, described further in <<Styling and Customization>>

==== NavigationConfig Factory

image::img/plugin_ui_navconfig.png[]

Unreal uses a NavigationConfig object to specify configuration information regarding tab navigation, digital versus analog directional navigation, and translation between keypresses and navigation actions or directions.

The mod.io Mod Browser allows you to specify a UModioNavigationConfigFactoryBase-derived class here, which will return an instance of a native FNavigationConfig object (or subclass) which can override the default behaviour for performing these tasks. 

NOTE: The FNavigationConfig class is a native-only class, so you will need to implement your overriding class in C++ if you wish to provide an alternative factory class, as we cannot return instances of FNavigationConfig directly from Blueprint functions.

==== Authentication Data Provider

image::img/plugin_ui_authprovider.png[]

A number of authentication providers are supported by mod.io, including email authentication, Steam, Xbox Live, and so on.

To tell the UI which authentication methods you wish to support, create a new class that implements `IModioUIAuthenticationDataProvider` and overrides the following functions:

* GetAuthenticationTypes(Blueprint)/NativeGetAuthenticationTypes(C++)
+ 
This function provides an array of FModioUIAuthenticationProviderInfo objects. Each object contains a field for you to specify an authentication method you want to support, and localized text to display for that authentication method in the UI.

* ShouldOfferEmailAuthentication(Blueprint)/NativeShouldOfferEmailAuthentication(C++)
+
This function returns a boolean indicating if the UI should offer email authentication as an option in the authentication dialog.
+
NOTE: If you either don't specify an authentication data provider, or your data provider returns an empty list of authentication methods, then email authentication will be offered as a fallback.

* GetAuthenticationParams(Blueprint)/NativeGetAuthenticationParams(C++)
+
This function is invoked by the mod.io UI with an `EModioAuthenticationProvider` enum value (based on the set that you returned in `GetAuthenticationTypes`) in order for you to populate it with the appropriate data. Perform whatever platform specific calls you need to make in order to retrieve the relevant authentication token, populate a `FModioAuthenticationParams` object, and return it. 

==== Input Hint Glyph Provider

image::img/plugin_ui_glyphprovider.png[]

The mod.io Mod Browser supports remapping inputs within your project, as mentioned above. Classes implementing `IModioUIInputHintGlyphProvider` allow the UI to query your project for a specific material displaying an input hint.

* GetInputGlyphMaterialForInputType(Blueprint)/NativeGetInputGlyphMaterialForInputType(C++)
+
This function will be invoked by the UI to offer your project a chance to return a specific material for a particular combination of virtual input and input device. Return `nullptr` from this function to fallback to the default implementation, which uses glyphs specified in the default style sheet. 

==== Featured Rows & Categories

image::img/plugin_ui_categories.png[]

The mod.io Mod Browser allows you to customize the Featured row and secondary category rows with custom search criteria suitable for your game. By default, the browser uses the `Modio/UI/Browser/DefaultModBrowserParams` object, which you are free to modify to suit your needs. However, you can also create your own by creating a Data Asset inheriting from ModioModBrowserParams, and specifying that object as the `BrowserCategoryConfiguration` in the mod.io UI Settings.

By default, the browser contains a single Featured Mods row (based off daily downloads), and additional rows of Highest Rated, Most Popular, Most Subscribers, Recently Added and Recently Updated.

=== Styling and Customization

For easier management of styling customization, `ModioUIDefaultStyle` contains multiple assets such that you can independently customize different aspects of the mod.io UI. 

image::img/plugin_ui_defaultstyle.png[]

When styling your UI, we recommend duplicating the existing `ModioUIDefaultStyle` asset and any child assets you wish to alter, rather than overriding the properties in the existing style assets. This will ensure that future UI updates will not cause conflicts with your changes.

==== Color, Material, and Style References

Palettized Colors, Materials and Widget Styles use special FName-based references so that visual elements of the UI can 'pull' information from the central Style Sheet asset at runtime.  These references are visible in the Editor and use Details Customizations so that you can select from a dropdown list of valid elements to reference.

* FModioUIStyleRef 
+
image::img/plugin_ui_styleref.png[]
This struct creates a reference to a specific named widget style defined in the `Widget Styles` property on the Style Sheet. Metadata on the UPROPERTY declaration in C++ is used to specify which specific type of Widget Style can be referenced.
* FModioUIMaterialRef
+
image::img/plugin_ui_materialref.png[]
This struct creates a reference to a specific named material from the `Named Brush Materials` property on the style sheet, and is primarily intended to allow for procedural material instances to be shared between multiple Brushes.
* FModioUIColorRef
+
image::img/plugin_ui_colorref.png[]
This struct references a specific named color from the `Color Presets` table in the style sheet.

==== Default Background Material

The mod.io Mod Browser supports a custom background, or removal of a background altogether. `ModioUIDefaultStyle` implements a `UMaterialInterface* DefaultBackgroundMaterial` which can be set to your chosen Material or Material Instance. 

image::img/plugin_ui_backgroundmaterial.png[]

==== Color Presets Data

Widgets in the Mod Browser reference a centrally defined color palette, `ModioUIColorPresets`. You can alter these colors by changing entries in the 'Color Presets' list.

NOTE: Changing the names of the existing colors will break references in widgets. You can, however, add additional colors to the palette and reference them in widgets or styles.

Referencing a palette entry in a widget style is simple - just click the 'Color Presets' dropdown and select the new palette entry you wish to reference.

image::img/plugin_ui_colorpresets.png[]

==== Widget Style Assets

Multiple Widget Style Assets have been created for different widget types.  

image::img/plugin_ui_widgetstyleassets.png[]

Each Widget Style Asset groups together a set of styles for a given asset type: 

* Borders 
* Buttons
* Input (editable text boxes, checkboxes)
* Panels (notifications, pop-ups, tiles, tables)
* Status (progress bars, subscription indicators)
* Text

For example, `ButtonStyles` (below) contains a map of styles that could be applied to a button depending on that button's function.

image::img/plugin_ui_editstyle.png[]

To customize a widget style, expand its entry in the relevant Widget Style Asset map and make changes as you see fit.

Similarly, to create a new widget style for a particular asset type, add a new entry to its widget style map and populate the values as required.

==== Customizing Audio

The plugin ships with two default pieces of audio for rollover/focus and selection. 

Where relevant, these are configurable per-control for a given widget in its Widget Style Asset.  For example, each style in the previous `ButtonStyles` example above has entries `Pressed Sound` and `Hovered Sound` assigned to `UI_Click_Cue` and `UI_Rollover_Cue` respectively.  

`S_Modio_UI` sound class can be used to control the volume of these default audio cues.

==== Named Glyphs Asset

This asset contains maps of `Named Glyphs` and `PNGGlyphs` that can be used to create a material instance of the specified SDF glyph or icon, which can then be referenced in other assets by name.

==== Material Data

The Mod Browser style sheet maintains a list of named materials and named material instance parameters that can be referenced by name by a style.  This allows materials and material instances to be easily shared between multiple widgets. The parameters for a named material are exposed in the `Named Brush Materials` property. There are currently 3 different types of parameters that can be specified:

* Specified Material Params
+
image::img/plugin_ui_specifiedmaterial.png[]
This parameter simply references a material from the project - essentially a wrapper allowing us to easily refer to the material by a centralised FName key.
* Rounded Rectangle Material Params
+
image::img/plugin_ui_roundedrectmaterial.png[]
This parameter set specifies a dynamic material instance of the 'RoundedRectangle' named material. It sets the included parameters on the new material instance.

==== Localization

ModioUISettings has a Modio Localization category with an empty map. When the user has a working project setup and enters PIE, every tag and category that exist in the game project is gathered to this map as a key-value pair. Every time a localized tag is requested from ModioUISubsystem and a tag is not found from this list, a new pair will be added. Values can be edited and formatted freely as well as removed from localization as there might be some tags such as numbers that do not need to be localized.

image::img/plugin_ui_empty_taglist.png[]
An empty map can be found from project settings before entering PIE for the first time with a proper API key.

image::img/plugin_ui_localized_tags.png[]
This is how the localized tags list should look like after entering PIE. The map should contain all categories and tags. Map values are saved as FText and can be edited normally. Keys should be left untouched.

=== Known Issues

This release of the UI contains some known issues that are currently being improved.

* Unreal Engine 5 is not officially supported, therefore there may be some display or functionality issues related to the mod browser.
* Offline mode is not supported. If there are connectivity issues to the mod.io API then the UI behavior is currently undefined.
* Changing users by logging out and logging back in as a new user may result in some inconsistent UI state related to mod collections. This does not occur after restarting.
* Transparent PNGs retrieved for mod galleries, logos etc may not display correctly
